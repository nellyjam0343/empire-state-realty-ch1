<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Empire State Realty</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #0A0A0F; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="scenes.js"></script>
  <script type="text/babel">
const { useState, useEffect, useRef } = React;

const SAVE_KEY = 'esr_v3';

const CHAPTER_META = [
  {num:1,title:"License Law"},
  {num:2,title:"Law of Agency"},
  {num:3,title:"Estates & Interests"},
  {num:4,title:"Leases & Contracts"},
  {num:5,title:"Mortgages"},
  {num:6,title:"Land Use"},
  {num:7,title:"Construction & Environment"},
  {num:8,title:"Valuation"},
  {num:9,title:"Human Rights & Fair Housing"},
  {num:10,title:"Real Estate Math"},
  {num:11,title:"Municipal Agencies"},
  {num:12,title:"Property Insurance"},
  {num:13,title:"Licensee Safety"},
  {num:14,title:"Taxes & Assessments"},
  {num:15,title:"Condos & Co-ops"},
  {num:16,title:"Commercial Investment"},
  {num:17,title:"Commercial Leases"},
  {num:18,title:"Income Tax"},
  {num:19,title:"Mortgage Brokerage & Mgmt"},
];

function App() {
  const [screen, setScreen] = useState('title');
  const [cash, setCash] = useState(500);
  const [rep, setRep] = useState(0);
  const [streak, setStreak] = useState(0);
  const [bestStreak, setBestStreak] = useState(0);
  const [chapterData, setChapterData] = useState({});
  const [currentCh, setCurrentCh] = useState(1);
  const [sceneIdx, setSceneIdx] = useState(0);
  const [phase, setPhase] = useState('narrative');
  const [narIdx, setNarIdx] = useState(0);
  const [cardIdx, setCardIdx] = useState(0);
  const [pick, setPick] = useState(null);
  const [toast, setToast] = useState(null);
  const [shakeIdx, setShakeIdx] = useState(-1);
  const tt = useRef(null);

  useEffect(() => {
    try {
      const s = JSON.parse(localStorage.getItem(SAVE_KEY));
      if (s) {
        setCash(s.cash||500); setRep(s.rep||0); setBestStreak(s.bestStreak||0); setChapterData(s.chapterData||{});
        setStreak(s.streak||0);
        if (s.session) {
          setCurrentCh(s.session.ch||1); setSceneIdx(s.session.sceneIdx||0);
          setPhase(s.session.phase||'narrative'); setNarIdx(s.session.narIdx||0);
          setCardIdx(s.session.cardIdx||0); setPick(s.session.pick!==undefined?s.session.pick:null);
          setScreen(s.session.screen||'title');
        }
      }
    } catch(e) {}
  }, []);

  useEffect(() => {
    try { localStorage.setItem(SAVE_KEY, JSON.stringify({
      cash,rep,bestStreak,chapterData,streak,
      session:{screen,ch:currentCh,sceneIdx,phase,narIdx,cardIdx,pick}
    })); } catch(e) {}
  }, [cash, rep, bestStreak, chapterData, streak, screen, currentCh, sceneIdx, phase, narIdx, cardIdx, pick]);

  const flash = (msg, type='gold') => {
    clearTimeout(tt.current);
    setToast({msg, type});
    tt.current = setTimeout(() => setToast(null), 2500);
  };

  const scenes = window.ALL_SCENES[currentCh] || [];
  const completed = chapterData[currentCh] || {};
  const correctCount = Object.values(completed).filter(v => v.correct).length;
  const totalPlayed = Object.keys(completed).length;

  const globalCorrect = Object.entries(chapterData).reduce((sum, [ch, data]) => sum + Object.values(data).filter(v=>v.correct).length, 0);
  const globalTotal = Object.entries(chapterData).reduce((sum, [ch, data]) => sum + Object.keys(data).length, 0);
  const totalScenes = Object.values(window.ALL_SCENES).reduce((sum, arr) => sum + arr.length, 0);

  const startChapter = (ch) => {
    const s = window.ALL_SCENES[ch] || [];
    const comp = chapterData[ch] || {};
    const first = s.findIndex((_, i) => !comp[i]);
    const start = first >= 0 ? first : 0;
    setCurrentCh(ch);
    setSceneIdx(start); setPhase('narrative'); setNarIdx(0); setCardIdx(0); setPick(null); setShakeIdx(-1); setStreak(0); setScreen('play');
  };

  const replayChapter = () => {
    setSceneIdx(0); setPhase('narrative'); setNarIdx(0); setCardIdx(0); setPick(null); setShakeIdx(-1); setStreak(0); setScreen('play');
  };

  const scene = scenes[sceneIdx];

  const advanceNarrative = () => {
    if (narIdx < scene.narrative.length - 1) setNarIdx(narIdx + 1);
    else { setPhase('learn'); setCardIdx(0); }
  };

  const advanceCard = () => {
    if (cardIdx < scene.learn.cards.length - 1) setCardIdx(cardIdx + 1);
    else { setPhase('challenge'); setPick(null); setShakeIdx(-1); }
  };

  const prevCard = () => { if (cardIdx > 0) setCardIdx(cardIdx - 1); };

  const answer = (idx) => {
    if (pick !== null) return;
    setPick(idx);
    const ok = idx === scene.challenge.correct;
    if (!ok) setShakeIdx(idx);
    const sv = ok ? streak + 1 : 0;
    const bonus = ok ? Math.min(streak, 5) * 100 : 0;
    const base = ok ? 500 : 0;
    const reward = base + bonus;
    setStreak(sv);
    if (ok && sv > bestStreak) setBestStreak(sv);
    setCash(c => c + reward);
    setRep(r => r + (ok ? 50 : 10));
    setChapterData(cd => ({...cd, [currentCh]: {...(cd[currentCh]||{}), [sceneIdx]: {correct: ok}}}));
    if (ok) flash('+$' + reward.toLocaleString() + (bonus > 0 ? '  \ud83d\udd25 \u00d7' + sv : ''));
  };

  const nextScene = () => {
    if (sceneIdx + 1 >= scenes.length) { setScreen('finale'); }
    else { setSceneIdx(sceneIdx + 1); setPhase('narrative'); setNarIdx(0); setCardIdx(0); setPick(null); setShakeIdx(-1); }
  };

  const resetAll = () => {
    if (confirm('Reset ALL progress across all chapters?')) {
      localStorage.removeItem(SAVE_KEY);
      setCash(500); setRep(0); setBestStreak(0); setChapterData({}); setStreak(0); setScreen('title');
    }
  };

  const S = {
    page: { minHeight:'100vh', background:'#0A0A0F', fontFamily:"'DM Sans',sans-serif", color:'#DAD8D0', WebkitFontSmoothing:'antialiased' },
    gold: '#D4A853', green: '#3DD68C', red: '#F0544F', orange: '#F5A623', purple: '#A78BFA', blue: '#60A5FA',
    bg2: '#12121A', bg3: '#1A1A28', bg4: '#252538', dim: '#5E5E72', bright: '#F5F4F0',
  };

  /* Helper to render HTML content safely - all content is static developer-authored strings */
  const renderCard = (html) => {
    const el = React.createElement('div', {
      style:{fontSize:15,lineHeight:1.7,color:'#DAD8D0'},
      dangerouslySetInnerHTML:{__html:html}
    });
    return el;
  };

  return (
    <div style={S.page}>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;900&family=DM+Sans:wght@300;400;500;600;700&display=swap');
        @keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
        @keyframes popIn{0%{transform:scale(0.8);opacity:0}60%{transform:scale(1.05)}100%{transform:scale(1);opacity:1}}
        @keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
        @keyframes glow{0%,100%{box-shadow:0 0 8px rgba(212,168,83,0.15)}50%{box-shadow:0 0 28px rgba(212,168,83,0.4)}}
        @keyframes pulseB{0%,100%{border-color:rgba(212,168,83,.15)}50%{border-color:rgba(212,168,83,.4)}}
        button{font-family:'DM Sans',sans-serif;cursor:pointer;border:none;outline:none;-webkit-tap-highlight-color:transparent}
        button:active{transform:scale(0.97)!important}
        ::selection{background:rgba(212,168,83,.3)}
        ::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#252538;border-radius:4px}
      `}</style>

      {toast && <div style={{position:'fixed',top:20,left:'50%',transform:'translateX(-50%)',zIndex:999,padding:'10px 24px',borderRadius:10,fontWeight:700,fontSize:15,pointerEvents:'none',
        color:toast.type==='green'?'#fff':'#0B0B11',
        background:toast.type==='green'?'linear-gradient(135deg,#3DD68C,#22A06B)':'linear-gradient(135deg,#E8C97A,#D4A853)',
        boxShadow:'0 6px 28px rgba(0,0,0,.5)',animation:'popIn .35s ease-out'}}>{toast.msg}</div>}

      {screen === 'title' && (
        <div style={{minHeight:'100vh',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',
          padding:'40px 20px',textAlign:'center',
          background:'radial-gradient(ellipse at 50% 15%,rgba(212,168,83,.06) 0%,transparent 60%)',animation:'fadeUp .5s ease-out'}}>
          <div style={{fontSize:11,letterSpacing:5,color:S.gold,fontWeight:600,marginBottom:8}}>NEW YORK REAL ESTATE</div>
          <h1 style={{fontFamily:"'Playfair Display',serif",fontSize:'clamp(36px,7vw,58px)',fontWeight:900,lineHeight:1.05,
            background:'linear-gradient(160deg,#E8C97A 20%,#D4A853 50%,#B8922F 80%)',
            WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent',marginBottom:4}}>Empire State{'\n'}Realty</h1>
          <p style={{color:S.dim,fontSize:15,maxWidth:440,lineHeight:1.6,marginTop:10,marginBottom:32}}>
            Learn the law. Pass the test. Build the empire.<br/>
            <strong style={{color:'#DAD8D0'}}>19 chapters</strong> {'\u2022'} <strong style={{color:'#DAD8D0'}}>{totalScenes} scenes</strong> {'\u2022'} Set in <strong style={{color:'#DAD8D0'}}>The Bronx</strong></p>

          {globalTotal > 0 && (
          <div style={{background:S.bg2,borderRadius:16,padding:'20px 24px',marginBottom:28,
            border:'1px solid rgba(212,168,83,.12)',maxWidth:420,width:'100%'}}>
            <div style={{display:'flex',justifyContent:'space-around'}}>
              <Stat l="Cash" v={'$'+cash.toLocaleString()} c={S.gold} />
              <Stat l="Correct" v={globalCorrect+'/'+totalScenes} c={S.green} />
              <Stat l="Rep" v={rep.toLocaleString()} c={S.purple} />
            </div>
          </div>)}

          <button onClick={()=>setScreen('chapters')} style={{padding:'15px 44px',borderRadius:12,fontSize:16,fontWeight:700,letterSpacing:.5,
            background:'linear-gradient(135deg,#D4A853,#B8922F)',color:'#0B0B11',
            boxShadow:'0 4px 20px rgba(212,168,83,.25)'}}>
            {globalTotal > 0 ? 'CONTINUE LEARNING' : 'BEGIN YOUR JOURNEY'}</button>

          {globalTotal > 0 && <button onClick={resetAll} style={{marginTop:12,fontSize:12,color:S.dim,background:'none',padding:8}}>Reset All Progress</button>}
          <div style={{marginTop:28,fontSize:12,color:S.dim}}>Built for Emerson \ud83c\udfd9\ufe0f</div>
        </div>
      )}

      {screen === 'chapters' && (
        <div style={{minHeight:'100vh',padding:'20px 16px',
          background:'radial-gradient(ellipse at 50% 5%,rgba(212,168,83,.04) 0%,transparent 50%)',animation:'fadeUp .4s ease-out'}}>
          <div style={{maxWidth:700,margin:'0 auto'}}>
            <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:20}}>
              <button onClick={()=>setScreen('title')} style={{fontSize:13,color:S.dim,background:'none',padding:'8px 0'}}>{'\u2190'} Home</button>
              <div style={{display:'flex',gap:14,fontSize:13}}>
                <span style={{color:S.gold}}>{'\ud83d\udcb0'} ${cash.toLocaleString()}</span>
                <span style={{color:S.purple}}>{'\u2b50'} {rep}</span>
              </div>
            </div>
            <div style={{textAlign:'center',marginBottom:24}}>
              <div style={{fontSize:11,letterSpacing:4,color:S.gold,fontWeight:600,marginBottom:4}}>SELECT A CHAPTER</div>
              <h2 style={{fontFamily:"'Playfair Display',serif",fontSize:24,fontWeight:700,color:S.bright}}>Your Study Path</h2>
            </div>
            <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(200px,1fr))',gap:10}}>
              {CHAPTER_META.map(ch => {
                const s = window.ALL_SCENES[ch.num] || [];
                const cd = chapterData[ch.num] || {};
                const done = Object.keys(cd).length;
                const right = Object.values(cd).filter(v=>v.correct).length;
                const pct = s.length > 0 ? Math.round((done/s.length)*100) : 0;
                const allDone = done >= s.length && s.length > 0;
                return (
                  <button key={ch.num} onClick={()=>startChapter(ch.num)}
                    style={{background:S.bg2,borderRadius:14,padding:'16px 14px',textAlign:'left',
                      border:'1px solid '+(allDone?'rgba(61,214,140,.2)':'rgba(255,255,255,.04)'),
                      transition:'all .15s',position:'relative',overflow:'hidden'}}>
                    <div style={{display:'flex',alignItems:'center',gap:10,marginBottom:8}}>
                      <div style={{width:32,height:32,borderRadius:8,display:'flex',alignItems:'center',justifyContent:'center',
                        fontSize:14,fontWeight:700,flexShrink:0,
                        background:allDone?'rgba(61,214,140,.12)':'rgba(212,168,83,.08)',
                        color:allDone?S.green:S.gold}}>{allDone?'\u2713':ch.num}</div>
                      <div>
                        <div style={{fontSize:10,color:S.dim,letterSpacing:1,fontWeight:600}}>CHAPTER {ch.num}</div>
                        <div style={{fontSize:13,fontWeight:600,color:S.bright,lineHeight:1.3}}>{ch.title}</div>
                      </div>
                    </div>
                    <div style={{height:3,background:S.bg4,borderRadius:2,overflow:'hidden'}}>
                      <div style={{height:'100%',borderRadius:2,transition:'width .6s',width:pct+'%',
                        background:allDone?S.green:'linear-gradient(90deg,#D4A853,#E8C97A)'}} />
                    </div>
                    <div style={{fontSize:10,color:S.dim,marginTop:4}}>{done}/{s.length} scenes {right>0?'\u2022 '+right+' correct':''}</div>
                  </button>
                );
              })}
            </div>
          </div>
        </div>
      )}

      {screen === 'play' && scene && (
        <div style={{minHeight:'100vh',display:'flex',flexDirection:'column'}}>
          <div style={{background:S.bg2,borderBottom:'1px solid rgba(255,255,255,.04)',padding:'10px 16px',position:'sticky',top:0,zIndex:10}}>
            <div style={{maxWidth:640,margin:'0 auto',display:'flex',justifyContent:'space-between',alignItems:'center',fontSize:13}}>
              <div style={{display:'flex',alignItems:'center',gap:10}}>
                <button onClick={()=>setScreen('chapters')} style={{fontSize:12,color:S.dim,background:'none',padding:0}}>{'\u2190'}</button>
                <span style={{color:S.gold,fontWeight:600}}>Ch.{currentCh} {'\u2014'} {scene.title}</span>
              </div>
              <div style={{display:'flex',gap:14}}>
                <span style={{color:S.gold}}>{'\ud83d\udcb0'} ${cash.toLocaleString()}</span>
                {streak > 0 && <span style={{color:S.orange}}>{'\ud83d\udd25'} {streak}</span>}
              </div>
            </div>
            <div style={{maxWidth:640,margin:'4px auto 0',height:3,background:S.bg4,borderRadius:2,overflow:'hidden'}}>
              <div style={{height:'100%',borderRadius:2,transition:'width .6s',
                width:((sceneIdx + (phase==='challenge'&&pick!==null?1:0.5)) / scenes.length) * 100 + '%',
                background:'linear-gradient(90deg,#D4A853,#E8C97A)'}} />
            </div>
          </div>

          <div style={{flex:1,display:'flex',alignItems:'center',justifyContent:'center',padding:'20px 16px'}}>
            <div key={sceneIdx+'-'+phase} style={{maxWidth:600,width:'100%',animation:'fadeUp .45s ease-out'}}>

              {phase === 'narrative' && (() => {
                const line = scene.narrative[narIdx];
                const isLast = narIdx === scene.narrative.length - 1;
                const speakerColor = line.speaker==='marcus' ? S.gold : line.speaker==='denise' ? S.purple : null;
                return (
                  <div key={narIdx} style={{animation:'fadeUp .4s ease-out'}}>
                    <div style={{fontSize:11,color:S.gold,letterSpacing:2,fontWeight:600,marginBottom:16,textTransform:'uppercase'}}>
                      {'\ud83d\udccd'} {scene.location}
                    </div>
                    <div style={{
                      background:line.speaker==='narrator'?S.bg2: line.speaker==='marcus'?'rgba(212,168,83,.05)':'rgba(167,139,250,.05)',
                      borderRadius:18,padding:'24px 28px',
                      border:'1px solid ' + (line.speaker==='narrator'?'rgba(255,255,255,.04)': line.speaker==='marcus'?'rgba(212,168,83,.12)':'rgba(167,139,250,.12)'),
                      marginBottom:20}}>
                      {line.speaker !== 'narrator' && (
                        <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:10}}>
                          <div style={{width:32,height:32,borderRadius:'50%',display:'flex',alignItems:'center',justifyContent:'center',fontSize:16,
                            background:line.speaker==='marcus'?'rgba(212,168,83,.12)':'rgba(167,139,250,.12)'}}>
                            {line.speaker==='marcus'?'\ud83d\udc54':'\ud83d\udc69\u200d\ud83d\udcbc'}</div>
                          <span style={{fontSize:13,fontWeight:700,color:speakerColor,textTransform:'uppercase',letterSpacing:1}}>
                            {line.speaker==='marcus'?'Marcus Rivera':'Denise'}</span>
                        </div>
                      )}
                      <p style={{fontSize:17,lineHeight:1.7,color:S.bright,
                        fontStyle:line.speaker==='narrator'?'italic':'normal'}}>{line.text}</p>
                    </div>
                    <button onClick={advanceNarrative} style={{width:'100%',padding:'14px',borderRadius:12,fontSize:14,fontWeight:600,
                      background:isLast?'linear-gradient(135deg,#D4A853,#B8922F)':S.bg3,
                      color:isLast?'#0B0B11':S.dim,border:isLast?'none':'1px solid '+S.bg4}}>
                      {isLast ? '\ud83d\udcda Time to Learn \u2192' : 'Continue \u2192'}</button>
                    <div style={{textAlign:'center',marginTop:8,fontSize:11,color:S.dim}}>{narIdx+1} / {scene.narrative.length}</div>
                  </div>
                );
              })()}

              {phase === 'learn' && (() => {
                const card = scene.learn.cards[cardIdx];
                const isLast = cardIdx === scene.learn.cards.length - 1;
                return (
                  <div key={cardIdx} style={{animation:'fadeUp .4s ease-out'}}>
                    <div style={{textAlign:'center',marginBottom:20}}>
                      <div style={{fontSize:32,marginBottom:4}}>{scene.learn.emoji}</div>
                      <div style={{fontSize:11,color:S.gold,letterSpacing:3,fontWeight:700,textTransform:'uppercase'}}>{scene.learn.title}</div>
                    </div>
                    <div style={{background:S.bg2,borderRadius:20,padding:'28px 24px',
                      border:'1px solid rgba(212,168,83,.12)',marginBottom:16,
                      boxShadow:'0 8px 32px rgba(0,0,0,.3)',minHeight:140}}>
                      <div style={{fontSize:16,fontWeight:700,color:S.gold,marginBottom:10,lineHeight:1.3}}>{card.title}</div>
                      {renderCard(card.text)}
                    </div>
                    <div style={{display:'flex',justifyContent:'center',gap:6,marginBottom:16}}>
                      {scene.learn.cards.map((_, i) => (
                        <div key={i} style={{width:i===cardIdx?20:8,height:8,borderRadius:4,
                          background:i===cardIdx?S.gold:i<cardIdx?'rgba(212,168,83,.3)':S.bg4,transition:'all .3s'}} />
                      ))}
                    </div>
                    <div style={{display:'flex',gap:10}}>
                      {cardIdx > 0 && <button onClick={prevCard} style={{padding:'14px 20px',borderRadius:12,fontSize:14,fontWeight:600,
                        background:S.bg3,color:S.dim,border:'1px solid '+S.bg4}}>{'\u2190'} Back</button>}
                      <button onClick={advanceCard} style={{flex:1,padding:'14px',borderRadius:12,fontSize:14,fontWeight:700,
                        background:isLast?'linear-gradient(135deg,#D4A853,#B8922F)':S.bg3,
                        color:isLast?'#0B0B11':'#DAD8D0',border:isLast?'none':'1px solid '+S.bg4}}>
                        {isLast ? '\ud83c\udfaf Ready for the Challenge \u2192' : 'Next ('+(cardIdx+1)+'/'+scene.learn.cards.length+')'}</button>
                    </div>
                  </div>
                );
              })()}

              {phase === 'challenge' && (() => {
                const ch = scene.challenge;
                const answered = pick !== null;
                const correct = pick === ch.correct;
                return (
                  <div>
                    <div style={{background:S.bg2,borderRadius:16,padding:'20px 22px',marginBottom:16,
                      border:'1px solid rgba(255,255,255,.04)'}}>
                      <p style={{fontSize:14,lineHeight:1.65,color:S.dim,fontStyle:'italic'}}>{ch.setup}</p>
                    </div>
                    <div style={{background:S.bg2,borderRadius:18,padding:'24px 22px',marginBottom:14,
                      border:'1px solid rgba(212,168,83,.1)',animation:!answered?'pulseB 3s infinite':'none'}}>
                      <p style={{fontSize:17,fontWeight:600,lineHeight:1.6,color:S.bright}}>{ch.q}</p>
                    </div>
                    <div style={{display:'grid',gap:8}}>
                      {ch.a.map((ans, i) => {
                        const isThis = pick===i, isRight = i===ch.correct;
                        let bg=S.bg2, bdr='rgba(255,255,255,.06)', clr='#DAD8D0';
                        if(answered){
                          if(isRight){bg='rgba(61,214,140,.08)';bdr=S.green;clr=S.green}
                          else if(isThis){bg='rgba(240,84,79,.08)';bdr=S.red;clr=S.red}
                          else{clr=S.dim}
                        }
                        return (
                          <button key={i} onClick={()=>answer(i)}
                            style={{padding:'14px 16px',borderRadius:13,border:'2px solid '+bdr,background:bg,color:clr,
                              fontSize:15,fontWeight:500,textAlign:'left',cursor:answered?'default':'pointer',transition:'all .15s',
                              display:'flex',alignItems:'center',gap:12,
                              animation:answered&&isThis&&!isRight?'shake .4s ease-out':'none'}}>
                            <span style={{width:28,height:28,borderRadius:8,display:'flex',alignItems:'center',justifyContent:'center',
                              fontSize:12,fontWeight:700,flexShrink:0,
                              background:answered&&isRight?S.green:answered&&isThis?S.red:S.bg4,
                              color:answered&&(isRight||isThis)?'#fff':S.dim}}>
                              {answered&&isRight?'\u2713':answered&&isThis?'\u2717':String.fromCharCode(65+i)}</span>
                            <span>{ans}</span>
                          </button>
                        );
                      })}
                    </div>
                    {answered && (
                    <div style={{marginTop:14,animation:'fadeUp .4s ease-out'}}>
                      <div style={{borderRadius:14,padding:'16px 20px',marginBottom:8,
                        background:correct?'rgba(61,214,140,.06)':'rgba(240,84,79,.06)',
                        border:'1px solid '+(correct?'rgba(61,214,140,.15)':'rgba(240,84,79,.15)')}}>
                        <div style={{fontSize:14,fontWeight:700,color:correct?S.green:S.red,marginBottom:4}}>
                          {correct?'\u2705 Correct!':'\u274c Not quite.'}</div>
                        <div style={{fontSize:14,color:'#DAD8D0',lineHeight:1.55,opacity:.85}}>{ch.why}</div>
                      </div>
                      <div style={{background:'rgba(212,168,83,.04)',borderRadius:14,padding:'14px 18px',
                        border:'1px solid rgba(212,168,83,.1)',display:'flex',gap:10,alignItems:'flex-start'}}>
                        <span style={{fontSize:20}}>{'\ud83d\udc54'}</span>
                        <div>
                          <div style={{fontSize:11,fontWeight:700,color:S.gold,letterSpacing:1,marginBottom:3}}>MARCUS</div>
                          <div style={{fontSize:14,color:'#DAD8D0',lineHeight:1.55,fontStyle:'italic'}}>
                            {correct ? ch.right : ch.wrong}</div>
                        </div>
                      </div>
                      <button onClick={nextScene} style={{width:'100%',padding:'14px',borderRadius:12,marginTop:12,
                        background:'linear-gradient(135deg,#D4A853,#B8922F)',color:'#0B0B11',fontSize:15,fontWeight:700}}>
                        {sceneIdx+1>=scenes.length?'Complete Chapter \u2192':'Next Scene \u2192'}</button>
                    </div>)}
                  </div>
                );
              })()}
            </div>
          </div>
        </div>
      )}

      {screen === 'finale' && (
        <div style={{minHeight:'100vh',display:'flex',alignItems:'center',justifyContent:'center',padding:20,
          background:'radial-gradient(ellipse at 50% 25%,rgba(212,168,83,.06) 0%,transparent 60%)',animation:'fadeUp .5s ease-out'}}>
          <div style={{maxWidth:480,width:'100%',textAlign:'center'}}>
            <div style={{fontSize:11,color:S.gold,letterSpacing:4,fontWeight:600,marginBottom:8}}>CHAPTER {currentCh} COMPLETE</div>
            <h2 style={{fontFamily:"'Playfair Display',serif",fontSize:28,fontWeight:700,color:S.bright,marginBottom:6}}>
              {CHAPTER_META.find(c=>c.num===currentCh)?.title}</h2>
            <p style={{fontSize:13,color:S.dim,marginBottom:20}}>The Bronx {'\u2022'} Empire State Realty</p>
            {(() => {
              const pct = scenes.length > 0 ? Math.round((correctCount/scenes.length)*100) : 0;
              const g = pct>=90?'S':pct>=78?'A':pct>=67?'B':pct>=55?'C':'D';
              const gc = {S:S.gold,A:S.green,B:S.blue,C:S.orange,D:S.red}[g];
              const msg = pct>=90?"Perfect score! Marcus is impressed.":
                          pct>=78?"Solid chapter. You're building real knowledge.":
                          pct>=67?"You passed, but review the material again.":
                          "Rough chapter. Hit replay and try again.";
              return (
                <React.Fragment>
                  <div style={{width:100,height:100,borderRadius:'50%',margin:'0 auto 16px',
                    display:'flex',alignItems:'center',justifyContent:'center',fontSize:48,fontWeight:900,
                    fontFamily:"'Playfair Display',serif",color:gc,border:'3px solid '+gc,background:gc+'10',
                    animation:'glow 2.5s infinite,popIn .4s ease-out'}}>{g}</div>
                  <p style={{color:'#DAD8D0',fontSize:15,marginBottom:24,lineHeight:1.5,maxWidth:360,margin:'0 auto 24px'}}>{msg}</p>
                </React.Fragment>
              );
            })()}
            <div style={{display:'flex',gap:4,justifyContent:'center',marginBottom:20}}>
              {scenes.map((_, i) => {
                const d = (chapterData[currentCh]||{})[i];
                return <div key={i} style={{width:32,height:8,borderRadius:4,
                  background:d?.correct?S.green:d?S.red:S.bg4}} />;
              })}
            </div>
            <div style={{background:S.bg2,borderRadius:16,padding:20,border:'1px solid rgba(255,255,255,.04)',marginBottom:20}}>
              <div style={{display:'flex',justifyContent:'space-around'}}>
                <Stat l="Correct" v={correctCount+'/'+scenes.length} c={S.green} />
                <Stat l="Cash" v={'$'+cash.toLocaleString()} c={S.gold} />
                <Stat l="Best Streak" v={'\ud83d\udd25 '+bestStreak} c={S.orange} />
              </div>
            </div>
            <div style={{display:'flex',gap:10}}>
              <button onClick={replayChapter} style={{flex:1,padding:'14px',borderRadius:12,
                background:S.bg3,color:'#DAD8D0',fontSize:15,fontWeight:600,border:'1px solid '+S.bg4}}>Replay</button>
              <button onClick={()=>setScreen('chapters')} style={{flex:1,padding:'14px',borderRadius:12,
                background:'linear-gradient(135deg,#D4A853,#B8922F)',color:'#0B0B11',fontSize:15,fontWeight:700}}>All Chapters</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

function Stat({ l, v, c }) {
  return (
    <div style={{textAlign:'center'}}>
      <div style={{fontSize:18,fontWeight:700,color:c,fontFamily:"'Playfair Display',serif"}}>{v}</div>
      <div style={{fontSize:10,color:'#5E5E72',letterSpacing:1,textTransform:'uppercase',marginTop:2}}>{l}</div>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
  </script>
</body>
</html>
